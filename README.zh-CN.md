# åŸºäºc++11çš„è½»é‡çº§çº¿ç¨‹æ± 

**ä¸€ä¸ªè·¨å¹³å°, ç®€å•æ˜“ç”¨çš„Header-onlyçº¿ç¨‹æ± åº“, åŸºäºTaskæäº¤, æ”¯æŒæäº¤ä»»æ„å‚æ•°æäº¤, æ”¯æŒè·å–è¿”å›å€¼.**

------

### ğŸ“Œ çº¿ç¨‹æ± ç®€ä»‹

**çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰**æ˜¯ä¸€ç§åŸºäº**æ± åŒ–æ€æƒ³**ç®¡ç†çº¿ç¨‹çš„å·¥å…·ï¼Œç»å¸¸å‡ºç°åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ã€‚

å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**é¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹æ”¾åœ¨â€œæ± å­â€é‡Œï¼Œä»»åŠ¡æ¥äº†å°±æŠŠä»»åŠ¡äº¤ç»™ç©ºé—²çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æ–°å»ºçº¿ç¨‹ã€‚**

![Thread_pool.svg](assets/Thread_pool.svg.png)

------

### ğŸš€ç‰¹æ€§äº®ç‚¹

- **ä»»åŠ¡æäº¤çµæ´»**ï¼šæ”¯æŒä»»æ„å¯è°ƒç”¨å¯¹è±¡ä¸å‚æ•°ç»„åˆï¼Œè¿”å› `std::future<T>` è·å–æ‰§è¡Œç»“æœ
- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨ `std::mutex` / `std::condition_variable` / `std::atomic` æ„å»ºåŒæ­¥æœºåˆ¶
- **è·¨å¹³å°**ï¼šçº¯ C++11 å®ç°ï¼Œå…¼å®¹ Windows ä¸ POSIX ç­‰ç³»ç»Ÿ
- **Header-only**ï¼šä»…éœ€åŒ…å« `thread_pool.h`ï¼Œé›¶ä¾èµ–ï¼Œå³å¯ä½¿ç”¨
- **RAII è‡ªåŠ¨ç®¡ç†èµ„æº**ï¼šææ„æ—¶è‡ªåŠ¨å…³é—­çº¿ç¨‹æ± ï¼Œé˜²æ­¢èµ„æºæ³„éœ²
- **ä»»åŠ¡ç­‰å¾…æœºåˆ¶**ï¼šæ”¯æŒä¸»åŠ¨è°ƒç”¨ `wait_all()` ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
- **çµæ´»å…³é—­ç­–ç•¥**ï¼šé»˜è®¤æ˜¯è‡ªåŠ¨å…³é—­çº¿ç¨‹æ± çš„, å¦‚æœæœ‰éœ€è¦å¯ä»¥æ‰‹åŠ¨å…³é—­çº¿ç¨‹æ± :
  - `WaitForAllTasks`: ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆåå…³é—­
  - `DiscardPendingTasks`: ä¸¢å¼ƒæœªå¼€å§‹çš„ä»»åŠ¡ç«‹å³å…³é—­

------

### ğŸ“¦ å¿«é€Ÿå¼€å§‹

#### å®‰è£…ä½¿ç”¨

æ‹·è´[`thread_pool.h`](include/thread_pool/thread_pool.h)åˆ°ä½ çš„é¡¹ç›®ç›®å½•ï¼Œç„¶ååœ¨ä»£ç ä¸­å¼•å…¥ï¼š

```cpp
#include "thread_pool.h"
```

æ— éœ€é¢å¤–ä¾èµ–ï¼Œå®Œå…¨å¤´æ–‡ä»¶å®ç°ã€‚

#### åŸºç¡€ç¤ºä¾‹ä»£ç 

```cpp
#include "thread_pool.h"
#include <iostream>

int main() {
  abin::threadpool executor(4);

  auto future1 = executor.submit([] { return 42; });
  std::cout << "ç»“æœ: " << future1.get() << "\n";

  auto future2 = executor.submit([](int a, int b) { return a + b; }, 5, 7);
  std::cout << "åŠ æ³•ç»“æœ: " << future2.get() << "\n";

  return 0;
}
```

æ›´å¤šæ›´è¯¦ç»†çš„ä½¿ç”¨æ¡ˆä¾‹, è¯·ç§»æ­¥åˆ°[`examples`](examples/)æ–‡ä»¶å¤¹ä¸‹æŸ¥çœ‹

------

### ğŸ“„  API æ–‡æ¡£

#### æ„é€ ä¸ææ„

```cpp
explicit threadpool(std::size_t thread_count = default_thread_count());
~threadpool();
```

- æ„é€ æ—¶è‡ªåŠ¨å¯åŠ¨ `thread_count` ä¸ªå·¥ä½œçº¿ç¨‹
- é»˜è®¤çº¿ç¨‹æ•°ä½¿ç”¨ `std::thread::hardware_concurrency()`ï¼ˆè‹¥ä¸å¯ç”¨åˆ™ä¸º 4ï¼‰
- ææ„æ—¶è‡ªåŠ¨è°ƒç”¨ `shutdown(WaitForAllTasks)`

#### æäº¤ä»»åŠ¡

```cpp
template <typename F, typename... Args>
auto submit(F&& f, Args&&... args) -> std::future<decltype(f(args...))>;
```

- å°†ä»»åŠ¡æäº¤è‡³çº¿ç¨‹æ± å¼‚æ­¥æ‰§è¡Œ
- æ”¯æŒä»»æ„å‡½æ•°å’Œå‚æ•°ç»„åˆ (ç»“åˆlambdaå¯è°ƒç”¨æˆå‘˜å‡½æ•°)
- è¿”å› `std::future` å¯¹è±¡ä»¥è·å–ç»“æœ

#### ç­‰å¾…ä»»åŠ¡å®Œæˆ

```cpp
void wait_all();
```

- é˜»å¡ç›´åˆ°æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ˆä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºä¸”æ— æ´»è·ƒçº¿ç¨‹ï¼‰
- è‹¥æ— ä»»åŠ¡ï¼Œç«‹å³è¿”å›

#### å…³é—­çº¿ç¨‹æ± 

```cpp
void shutdown(shutdown_mode mode = shutdown_mode::WaitForAllTasks);
```

- ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆæˆ–ç«‹å³ä¸¢å¼ƒæœªå¼€å§‹ä»»åŠ¡å¹¶é€€å‡º
- è°ƒç”¨åçº¿ç¨‹æ± ä¸å¯ç»§ç»­æäº¤ä»»åŠ¡

#### é‡å¯çº¿ç¨‹æ± 

```cpp
void reboot(std::size_t thread_count);
```

- å®‰å…¨åœ°å…³é—­å¹¶ä»¥æŒ‡å®šçº¿ç¨‹æ•°é‡å¯çº¿ç¨‹æ± 

#### è·å–çŠ¶æ€ä¿¡æ¯

```cpp
bool is_running() const noexcept;               // çº¿ç¨‹æ± æ˜¯å¦åœ¨è¿è¡Œ
std::size_t total_threads() const noexcept;     // çº¿ç¨‹æ± æ€»å…±çš„çº¿ç¨‹æ•°
std::size_t busy_threads() const noexcept;      // ç¹å¿™çš„çº¿ç¨‹æ•°é‡
std::size_t idle_threads() const noexcept;      // ç©ºé—²çš„çº¿ç¨‹æ•°é‡
std::size_t pending_tasks() const noexcept;     // æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡æ•°é‡
threadpool::status status() const noexcept;     // çŠ¶æ€ä¿¡æ¯æ±‡æ€»
```

------

### ğŸ’¡ è´¡çŒ®æŒ‡å—

ğŸ—¨ï¸ æ¬¢è¿æäº¤ **Issue** å’Œ **Pull request** æ¥æ”¹è¿›æœ¬é¡¹ç›®ï¼

-----

### ğŸ™Œ è‡´è°¢

æ„Ÿè°¢ **[Catch2](https://github.com/catchorg/Catch2)** æä¾›å¼ºå¤§æ”¯æŒï¼ŒåŠ©åŠ›æœ¬é¡¹ç›®çš„å•å…ƒæµ‹è¯•!

------

### ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨[ **MIT** è®¸å¯è¯](./LICENSE)ã€‚ç‰ˆæƒæ‰€æœ‰ Â© 2025â€“Present Abinã€‚

------

### ğŸ™‹â€â™‚ï¸ ä½œè€…

Abin ğŸ“§ [GitHub](https://github.com/abin-z)
